<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simon Says</title>
    <style>
        /* --- General Layout and Mobile Optimization --- */
        body {
            background-color: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* Use min-height for mobile screens */
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            touch-action: manipulation; /* Prevents unwanted mobile behavior like double tap zoom */
        }

        /* The C4 Package - Ensure it scales on mobile */
        .c4-package {
            position: relative;
            width: 90vw; /* Responsive width */
            max-width: 400px; /* Cap size on large screens */
            background-color: #4a4a4a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
            border: 1px solid #666;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Texture overlay */
        .c4-package::before {
            content: '';
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 2px dashed #333;
            pointer-events: none;
            border-radius: 5px;
        }

        /* Digital Timer */
        .timer-display {
            background-color: #000;
            color: #ff0000;
            font-size: 1.8rem; /* Slightly smaller for mobile layout */
            font-family: 'Courier New', monospace;
            padding: 8px 20px;
            border: 4px solid #333;
            border-radius: 5px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ff0000;
            letter-spacing: 3px;
            z-index: 2;
            width: 80%; /* Ensure it spans the package */
            text-align: center;
        }

        /* Wire Container */
        .wire-container {
            display: flex;
            justify-content: space-around; /* Distribute wires evenly */
            gap: 10px;
            margin-bottom: 20px;
            z-index: 2;
            width: 100%; /* Ensure it uses the full package width */
            padding: 0 10px;
        }

        /* The Wires (Buttons) - Larger touch target for mobile */
        .wire {
            flex-grow: 1; /* Allow wires to grow to fill space */
            width: 50px; /* Base width */
            height: 100px; /* Base height */
            border-radius: 10px; /* Square off corners for easier tapping */
            cursor: pointer;
            position: relative;
            transition: transform 0.1s;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            border: 2px solid rgba(0,0,0,0.2);
            /* Make sure the touch target is the entire element */
            -webkit-tap-highlight-color: transparent; 
        }

        .wire:active { transform: scale(0.95); }

        /* Wire Colors (no change needed) */
        .red { background: linear-gradient(to right, #b71c1c, #f44336, #b71c1c); }
        .blue { background: linear-gradient(to right, #0d47a1, #2196f3, #0d47a1); }
        .green { background: linear-gradient(to right, #1b5e20, #4caf50, #1b5e20); }
        .yellow { background: linear-gradient(to right, #f57f17, #ffeb3b, #f57f17); }

        /* Active/Lit State */
        .wire.lit {
            filter: brightness(2.5);
            box-shadow: 0 0 20px white;
        }

        /* Start Button */
        .btn-start {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 12px 25px; /* Larger tap area */
            cursor: pointer;
            font-family: inherit;
            text-transform: uppercase;
            font-weight: bold;
            z-index: 2;
        }
        .btn-start:hover { background: #444; }

        .btn-back {
            margin-top: 15px;
            color: #888;
            text-decoration: none;
            font-size: 0.8rem;
            z-index: 2;
        }

        /* Explosion Overlay */
        #explosion {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #ff0000 0%, #000000 90%);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 100;
        }
        
        .message {
            font-size: 3rem; /* Smaller BOOM for mobile screens */
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px black;
        }
        
        /* Success Overlay */
        #success-msg {
            color: #4caf50;
            font-weight: bold;
            display: none;
            margin-top: 10px;
            text-shadow: 0 0 5px #4caf50;
        }

    </style>
</head>
<body>

    <div class="c4-package">
        <div class="timer-display" id="timer">00:00</div>
        
        <div class="wire-container">
            <div class="wire red" id="red" onclick="handleInput('red')"></div>
            <div class="wire blue" id="blue" onclick="handleInput('blue')"></div>
            <div class="wire yellow" id="yellow" onclick="handleInput('yellow')"></div>
            <div class="wire green" id="green" onclick="handleInput('green')"></div>
        </div>

        <button class="btn-start" onclick="startGame()" id="startBtn">Arm Device</button>
        <div id="success-msg">SEQUENCE DEFUSED</div>
        <a href="../index.html" class="btn-back">ABORT MISSION</a>
    </div>

    <div id="explosion">
        <div class="message">BOOM</div>
        <button class="btn-start" onclick="location.reload()">RETRY</button>
    </div>

    <script>
        const wires = ['red', 'blue', 'yellow', 'green'];
        const timerEl = document.getElementById('timer');
        const startBtn = document.getElementById('startBtn');
        const explosionEl = document.getElementById('explosion');
        const successEl = document.getElementById('success-msg');

        let sequence = [];
        let playerSequence = [];
        let level = 0;
        let isPlaying = false; // Is the computer showing the sequence?
        let timeLeft = 0;
        let timerInterval;

        function startGame() {
            sequence = [];
            playerSequence = [];
            level = 0;
            startBtn.style.display = 'none'; // Hide button during game
            nextRound();
        }

        function nextRound() {
            level++;
            playerSequence = [];
            successEl.style.display = 'none';
            
            // Add a random color to the sequence
            const randomColor = wires[Math.floor(Math.random() * 4)];
            sequence.push(randomColor);

            // --- DIFFICULTY ADJUSTMENT FOR LONGER PLAYTIME ---
            // Timer: Starts at 1.5s per wire, reduces to 0.5s per wire at high levels (around level 21)
            let timePerWire = Math.max(0.5, 1.5 - (level * 0.05));
            timeLeft = sequence.length * timePerWire; 
            updateTimerDisplay();

            // Flashing Speed: Starts at 800ms, reduces to 400ms at high levels
            const flashSpeed = Math.max(400, 800 - (level * 20));

            // Play the sequence
            playSequence(flashSpeed);
        }

        function playSequence(speed) {
            isPlaying = true;
            let i = 0;
            
            const interval = setInterval(() => {
                flashWire(sequence[i]);
                i++;
                if (i >= sequence.length) {
                    clearInterval(interval);
                    isPlaying = false;
                    startTimer();
                }
            }, speed); // Use calculated speed for flashing
        }

        function flashWire(color) {
            const wire = document.getElementById(color);
            wire.classList.add('lit');
            setTimeout(() => {
                wire.classList.remove('lit');
            }, 300); // Shorter flash duration for faster play
        }

        function handleInput(color) {
            if (isPlaying || sequence.length === 0) return; // Ignore input while showing pattern

            flashWire(color); // Visual feedback
            playerSequence.push(color);

            // Check correctness immediately
            const index = playerSequence.length - 1;
            
            if (playerSequence[index] !== sequence[index]) {
                // FAIL CONDITION: Incorrect color
                detonate();
                return;
            }

            // Check if round complete
            if (playerSequence.length === sequence.length) {
                stopTimer();
                successEl.style.display = 'block';
                setTimeout(nextRound, 800); // Faster transition to next level
            }
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 0.01; // Check every 10ms for smoother timer
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    // FAIL CONDITION: Time ran out
                    detonate();
                }
            }, 10);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateTimerDisplay() {
            // Format to 00:00 (Seconds:Centiseconds)
            let s = Math.floor(timeLeft);
            // Calculate centiseconds (00-99)
            let cs = Math.floor((timeLeft % 1) * 100); 
            
            if (s < 0) s = 0;
            if (cs < 0) cs = 0;
            
            // If time is low, change color to red for urgency
            if (timeLeft < 3 && timeLeft > 0) {
                 timerEl.style.color = '#ff9900'; // Orange
            } else if (timeLeft <= 0.5) {
                 timerEl.style.color = '#ff0000'; // Red
            } else {
                 timerEl.style.color = '#ff0000'; // Default red
            }


            timerEl.innerText = 
                (s < 10 ? "0" + s : s) + ":" + 
                (cs < 10 ? "0" + cs : cs);
        }

        function detonate() {
            stopTimer();
            explosionEl.style.display = 'flex';
        }

        // Initialize timer display on load
        updateTimerDisplay(); 

    </script>
</body>
</html>