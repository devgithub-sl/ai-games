<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomb Defusal</title>
    <style>
        body {
            background-color: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        /* The C4 Package */
        .c4-package {
            position: relative;
            width: 350px;
            background-color: #4a4a4a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
            border: 1px solid #666;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Texture overlay */
        .c4-package::before {
            content: '';
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 2px dashed #333;
            pointer-events: none;
            border-radius: 5px;
        }

        /* Digital Timer */
        .timer-display {
            background-color: #000;
            color: #ff0000;
            font-size: 3rem;
            font-family: 'Courier New', monospace;
            padding: 10px 30px;
            border: 4px solid #333;
            border-radius: 5px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ff0000;
            letter-spacing: 5px;
            z-index: 2;
        }

        /* Wire Container */
        .wire-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            z-index: 2;
        }

        /* The Wires (Buttons) */
        .wire {
            width: 60px;
            height: 120px;
            border-radius: 30px;
            cursor: pointer;
            position: relative;
            transition: transform 0.1s;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            border: 2px solid rgba(0,0,0,0.2);
        }

        .wire:active { transform: scale(0.95); }

        /* Wire Colors */
        .red { background: linear-gradient(to right, #b71c1c, #f44336, #b71c1c); }
        .blue { background: linear-gradient(to right, #0d47a1, #2196f3, #0d47a1); }
        .green { background: linear-gradient(to right, #1b5e20, #4caf50, #1b5e20); }
        .yellow { background: linear-gradient(to right, #f57f17, #ffeb3b, #f57f17); }

        /* Active/Lit State */
        .wire.lit {
            filter: brightness(2.5);
            box-shadow: 0 0 20px white;
        }

        /* Start Button */
        .btn-start {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
            text-transform: uppercase;
            font-weight: bold;
            z-index: 2;
        }
        .btn-start:hover { background: #444; }

        .btn-back {
            margin-top: 15px;
            color: #888;
            text-decoration: none;
            font-size: 0.8rem;
            z-index: 2;
        }

        /* Explosion Overlay - SAFE MODE (No Flashing) */
        #explosion {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            
            /* Changed from flashing white/red to a static dark red/black gradient */
            background: radial-gradient(circle, #ff0000 0%, #000000 90%);
            
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 100;
            
            /* Removed animation: flash 0.1s infinite; */
        }

        /* You can delete the @keyframes flash entirely */
        
        .message {
            font-size: 5rem;
            font-weight: bold;
            color: white; /* Changed text to white for better contrast on dark bg */
            text-shadow: 0 0 20px black;
        }
        
        /* Success Overlay */
        #success-msg {
            color: #4caf50;
            font-weight: bold;
            display: none;
            margin-top: 10px;
            text-shadow: 0 0 5px #4caf50;
        }

    </style>
</head>
<body>

    <div class="c4-package">
        <div class="timer-display" id="timer">00:00</div>
        
        <div class="wire-container">
            <div class="wire red" id="red" onclick="handleInput('red')"></div>
            <div class="wire blue" id="blue" onclick="handleInput('blue')"></div>
            <div class="wire yellow" id="yellow" onclick="handleInput('yellow')"></div>
            <div class="wire green" id="green" onclick="handleInput('green')"></div>
        </div>

        <button class="btn-start" onclick="startGame()" id="startBtn">Arm Device</button>
        <div id="success-msg">SEQUENCE DEFUSED</div>
        <a href="../index.html" class="btn-back">ABORT MISSION</a>
    </div>

    <div id="explosion">
        <div class="message">BOOM</div>
        <button class="btn-start" onclick="location.reload()">RETRY</button>
    </div>

    <script>
        const wires = ['red', 'blue', 'yellow', 'green'];
        const timerEl = document.getElementById('timer');
        const startBtn = document.getElementById('startBtn');
        const explosionEl = document.getElementById('explosion');
        const successEl = document.getElementById('success-msg');

        let sequence = [];
        let playerSequence = [];
        let level = 0;
        let isPlaying = false; // Is the computer showing the sequence?
        let timeLeft = 0;
        let timerInterval;

        function startGame() {
            sequence = [];
            playerSequence = [];
            level = 0;
            startBtn.style.display = 'none'; // Hide button during game
            nextRound();
        }

        function nextRound() {
            level++;
            playerSequence = [];
            successEl.style.display = 'none';
            
            // Add a random color to the sequence
            const randomColor = wires[Math.floor(Math.random() * 4)];
            sequence.push(randomColor);

            // Reset Timer (Give 1.5 seconds per wire in sequence)
            // As levels get higher, you get less time per wire!
            let timePerWire = Math.max(0.8, 1.5 - (level * 0.05));
            timeLeft = Math.ceil(sequence.length * timePerWire) + 1; 
            updateTimerDisplay();

            // Play the sequence
            playSequence();
        }

        function playSequence() {
            isPlaying = true;
            let i = 0;
            
            const interval = setInterval(() => {
                flashWire(sequence[i]);
                i++;
                if (i >= sequence.length) {
                    clearInterval(interval);
                    isPlaying = false;
                    startTimer();
                }
            }, 800); // Speed of flashing
        }

        function flashWire(color) {
            const wire = document.getElementById(color);
            wire.classList.add('lit');
            // Sound effect visualizer (optional, just visual here)
            setTimeout(() => {
                wire.classList.remove('lit');
            }, 400);
        }

        function handleInput(color) {
            if (isPlaying || sequence.length === 0) return; // Ignore input while showing pattern

            flashWire(color); // Visual feedback
            playerSequence.push(color);

            // Check correctness immediately
            const index = playerSequence.length - 1;
            
            if (playerSequence[index] !== sequence[index]) {
                detonate();
                return;
            }

            // Check if round complete
            if (playerSequence.length === sequence.length) {
                stopTimer();
                successEl.style.display = 'block';
                setTimeout(nextRound, 1000);
            }
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    detonate();
                }
            }, 100);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateTimerDisplay() {
            // Format to 00:00 (Seconds:Milliseconds)
            let s = Math.floor(timeLeft);
            let ms = Math.floor((timeLeft % 1) * 100);
            if (s < 0) s = 0;
            if (ms < 0) ms = 0;
            
            timerEl.innerText = 
                (s < 10 ? "0" + s : s) + ":" + 
                (ms < 10 ? "0" + ms : ms);
        }

        function detonate() {
            stopTimer();
            explosionEl.style.display = 'flex';
        }

    </script>
</body>
</html>